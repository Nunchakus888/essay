---
layout: post
title:  æ¥ç‚¹ä¸å¸¸ç”¨çš„ES6.
date:   2017-09-02 01:08:08 +0800
categories: diary
location: ShangHai, China
description: let,const,class...? No,æ•´ç†ç‚¹ç¨å¾®æœ‰é€¼æ ¼çš„å¹²è´§.
tail: ä½œä¸ºä¸€åæœ‰è¿½æ±‚çš„æŠ€æœ¯å®…ï¼Œä½ è¯´æ˜¯å§ðŸ˜„

---
---

Iterators
-----------

+ Iterators are meant to eliminate the complexity and error-prone nature of loops
+ Iterators are objects with a specific interface designed for iteration
+ next() method
+ result object {value, done}
+ keeps an internal pointer to a location within a collection of values,
+ and with each call to the next() method, it returns the next appropriate value.

#### æ¥æˆ‘ä»¬æ‰‹åŠ¨é€ ä¸€ä¸ª:
```
function createIterators(list) {
    let i = 0;
    return {
        next: function() {
            const done = (i === list.length - 1);
            const value = list[i++];
            return {
                done: done,
                value: value
            }
        }
    }
}
iterators = createIterators([1,2,3,4]);
console.log(iterators.next()); //{ done: false, value: 1 }
console.log(iterators.next()); //{ done: false, value: 2 }
console.log(iterators.next()); //{ done: false, value: 3 }
console.log(iterators.next()); //{ done: false, value: 4 }

```

Generator
-----------

### åŸºç¡€ç”¨æ³•ï¼š
```
function *createIterator() {
    yield { a: 1 };
    yield { hello: 'world'};
    yield 3;
}

iterator = createIterator();
console.log(iterator.next()); //{ value: { a: 1 }, done: false }
console.log(iterator.next()); //{ value: { hello: 'world' }, done: false }
console.log(iterator.next()); //{ value: 3, done: false }
```

æˆ‘è§‰å¾—ä¸æ¥ä¸ªwhile trueå®Œå…¨ä¸è¶³ä»¥çºµæƒ…å•ŠðŸ˜„

```
function *plus() {
	let i = 0;
	while(true) {
		yield i++;
    }
}
gen = plus()
gen.next();
gen.next();
gen.next();
```

### é«˜çº§ç‚¹çš„ç”¨æ³•ï¼š
```
function *iteratorWithArgs() {
    let first = yield 10; //argæ— æ•ˆï¼Œ10
    let second = yield first + 2012; // arg + 2013
    yield second + 100000000000; // arg + 100000000000
}
iterator = iteratorWithArgs();
console.log(iterator.next(123)); //{ value: 10, done: false }
console.log(iterator.next(5)); //{ value: 2017, done: false }
console.log(iterator.next(88888888888)); //{ value: 188888888888, done: false }
```

### è¿˜æœ‰å¸¦äº‹æ•…ç±»åž‹çš„ðŸ˜…ï¼š
```
function *catchErrorIterator() {
    let first = yield 1;
    let second;
    try {
        second = yield first + 2; // yield 4 + 2, then throw
    } catch (ex) {
        second = 6;
    }
    yield second + 3;
}
iterator = catchErrorIterator();
console.log(iterator.next());
console.log(iterator.next(1000));
console.log(iterator.throw(new Error("Boom"))); // "{ value: 9, done: false }"
console.log(iterator.next());
```

### è¿˜æœ‰è‡ªå¸¦åˆ¶åŠ¨çš„ï¼š
```
function *iteratorWithReturn() {
    yield 1;
    return 10;
    yield 2;
    yield 3;
}
iterator = iteratorWithReturn();
console.log(iterator.next()); //{ value: 1, done: false }
console.log(iterator.next()); //{ value: 10, done: true } 
console.log(iterator.next()); //{ value: undefined, done: true } å‰ä¸€æ­¥æ“ä½œå·²returnï¼Œsoæ­¤å¤„undefined.
```
### å†æ¥ä¸ªç»„åˆå¼çš„ï¼š
```
function *createNumberIterator() {
    yield 1;
    yield 2;
}
function *createColorIterator() {
    yield "red";
    yield "green";
}
function *createCombinedIterator() {
    yield *createNumberIterator();
    yield *createColorIterator();
    yield true;
}
iterator = createCombinedIterator();
console.log(iterator.next());
console.log(iterator.next());
console.log(iterator.next());
console.log(iterator.next());
console.log(iterator.next());
console.log(iterator.next());
```

### è‡ªåŠ¨æ‰§è¡Œçš„

```
const generator = function * () {
    yield console.log();
    yield console.log('hello');
    yield console.log('ðŸ˜„');
    while (1) {
        yield console.log('ðŸ˜„'); //ä¼šæ¯”è¾ƒæ¬¢ä¹ï¼Œæ…Žç”¨å•Š
    }
};
const run = myGenerator => {
    const myIterator = myGenerator();
    let next;
    do {
        next = myIterator.next();
    } while (!next.done)
};
run(generator);
```

### å¼‚æ­¥çš„
to be continued...


for...of...
-----------

> All collection objects (arrays, sets, and maps) and strings are iterables in ECMAScript 2015

eg: Array
```
a = ['a','b',3];
iterator = a[Symbol.iterator]();
console.log(iterator.next()); //{ value: 'a', done: false }
console.log(iterator.next()); //{ value: 'b', done: false }
console.log(iterator.next()); //{ value: 3, done: false } æ•°ç»„çš„è¿™ä¸ªè¿­ä»£å°±æœ‰ç‚¹ç¬¨äº†ï¼Œå·²ç»æ˜¯æœ€åŽä¸€ä¸ªäº† doneè¿˜æ˜¯false..ä¼šå¤šå¢žåŠ ä¸€æ¬¡è¿­ä»£..
console.log(iterator.next()); //{ value: undefined, done: true }
```
+ å®˜æ›°ï¼š
    1. calls the Symbol.iterator method on the values array to retrieve an iterator
    2. iterator.next() is called
    3.  the value property on the iteratorâ€™s result object is read into num
    4. When done on the result object is true, the loop exits       
    5. The for-of statement will throw an error when you use it on a non-iterable object, null, or undefined.

### iteratableï¼Ÿè¿™ä¸ªè¯æ„Ÿè§‰æ˜¯å¼ºè¡Œé€ å‡ºæ¥çš„ï¼Œæ‹¼å†™æ£€æŸ¥æŠ¥é”™ðŸ˜„

```
o = {
    1: 1,
    2: 2,
    3: 3,
};

function isIteratable(object) {
    return typeof (object[Symbol.iterator]) === 'function';
}

console.log(isIteratable(o)); //false
console.log(isIteratable([])); //true
```

Promise
--------

```
const promise = new Promise(function(resolve, reject) {
    setTimeout(() => {
        resolve('mdzz')
    }, 1000)
});

promise.then((data) => {
    console.error('omg--1', data); //omg--1 mdzz
}, function(err) {
    // rejection
    console.error(err.message);
});

promise.catch(function(err) {
    // rejection
    console.error(err.message);
});

```

Object
----------

### è¿™æ®µæ˜¯å‚è€ƒäº†äººäººFEå¤§ç¥žçš„åˆ†äº«åšçš„ç¬”è®°ã€‚è¿™æ ·çš„æœºåˆ¶åœ¨å¼€å‘ä¸­è¿˜æ˜¯ä¸å®¹æ˜“å‘çŽ°çš„ã€‚æ‰€ä»¥æŠ•ä¸ªæœºï¼Œforkæ˜¯æœ€å¿«çš„å®žè·µ&å­¦ä¹ ðŸ˜„è‡´æ•¬äººäººFEå¤§ä½¬ä»¬ï¼@äººäººFE

+ Object.sealé˜²æ­¢æ–°å¢žå’Œåˆ é™¤`å±žæ€§`,æ³¨æ„åªæ˜¯å±žæ€§å“¦ï¼ŒåŽŸå¯¹è±¡è¿˜æ˜¯å¯ä»¥åˆ é™¤çš„ã€‚

```

æ¥åˆ æˆ‘å•Š = {
    åå­—: 'ç‰›é€¼'
};
Object.seal(æ¥åˆ æˆ‘å•Š);
æ¥åˆ æˆ‘å•Š.å¼ä¸å¼ = 'å¼ï¼';        //æ·»åŠ ä¸æˆåŠŸ
delete æ¥åˆ æˆ‘å•Š.åå­—;         //false
delete æ¥åˆ æˆ‘å•Š;            //true

```
+ Object.freezeå†»ç»“å¯¹è±¡ï¼Œä¸èƒ½æ”¹å±žæ€§å€¼ã€‚

åŒæ—¶å¯ä»¥ä½¿ç”¨Object.isFrozenã€Object.isSealedã€Object.isExtensibleåˆ¤æ–­å½“å‰å¯¹è±¡çš„çŠ¶æ€ã€‚

+ definePropertyå†»ç»“å•ä¸ªå±žæ€§ï¼Œè®¾ç½®enumable/writableä¸ºfalseï¼Œé‚£ä¹ˆ`è¿™ä¸ªå±žæ€§`å°†ä¸å¯éåŽ†å’Œå†™
  
```

aæ¥éåŽ†æˆ‘å•Š = {
    è®©ä¸è®©éåŽ†: 'åšå†³ä¸è®©ï¼'
};
Object.defineProperty(aæ¥éåŽ†æˆ‘å•Š, 'hello', {
    enumerable: false, //ä¸å¯éåŽ†
    writable: false, //ä¸å¯æ›´æ”¹
    value: 'world'
});
for (var i in aæ¥éåŽ†æˆ‘å•Š) {
    console.log(i) //è¾“å‡ºæ²¡æœ‰helloå±žæ€§.å…¶ä»–ä½¿ç”¨æ­£å¸¸.
}

```

defineProperty
------

```

function defineReactive(obj, key, val) {
    Object.defineProperty(obj, key, {
        get: function () {
            console.log(`read my attribute-->${key}`);
            return val;
        },
        set: function (newValue) {
            console.log(`set my attribute-->${key}`);
            val = newValue;
        }
    })
}
function observable(o) {
    Object.keys(o).forEach(i => {
        defineReactive(o, i, o[i]);
    })
}
const o = {
    name: 'Jekyll&Hyde',
    age: '23'
};

console.log(o.name);
console.log(o.name = 12332112331);

```
  

